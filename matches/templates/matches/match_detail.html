{% extends 'base.html' %}
{% load static %}

{% block title %}Watching: {{ match.title }}{% endblock %}

{% block content %}
<!-- Font: Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* --- MODERN AURORA THEME (Scoped) --- */
    :root {
        --bg-deep: #050507;
        --glass-surface: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.08);
        --accent-violet: #7000ff;
        --accent-cyan: #00f0ff;
        --font-modern: 'Inter', sans-serif;
    }

    body {
        background-color: var(--bg-deep) !important;
        font-family: var(--font-modern) !important;
        color: #e5e7eb;
        overflow-x: hidden;
    }

    /* --- AURORA BACKGROUND --- */
    .aurora-bg {
        position: fixed;
        inset: 0;
        z-index: -1;
        background: var(--bg-deep);
    }

    .aurora-blob {
        position: absolute;
        filter: blur(80px);
        opacity: 0.3;
        border-radius: 50%;
        animation: pulse-glow 10s infinite alternate;
    }

    .blob-1 {
        top: 0;
        left: 0;
        width: 60vw;
        height: 60vw;
        background: var(--accent-violet);
    }

    .blob-2 {
        bottom: 0;
        right: 0;
        width: 60vw;
        height: 60vw;
        background: var(--accent-cyan);
    }

    @keyframes pulse-glow {
        0% {
            opacity: 0.2;
            transform: scale(1);
        }

        100% {
            opacity: 0.3;
            transform: scale(1.1);
        }
    }

    /* --- PLAYER CONTAINER --- */
    .theater-container {
        display: flex;
        flex-direction: column;
        min-height: 85vh;
        /* Account for header/footer if present */
        justify-content: center;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .player-glass-frame {
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 5px;
        /* Bezel */
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        position: relative;
        aspect-ratio: 16/9;
    }

    iframe {
        width: 100%;
        height: 100%;
        border-radius: 16px;
        background: #000;
    }

    .match-header {
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .btn-back {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 500;
        transition: 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
    }

    .btn-back:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-decoration: none;
        transform: translateX(-3px);
    }

    .live-indicator {
        display: inline-flex;
        align-items: center;
        color: #fca5a5;
        background: rgba(239, 68, 68, 0.15);
        padding: 4px 12px;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 1px;
    }

    .live-dot {
        width: 8px;
        height: 8px;
        background: #ef4444;
        border-radius: 50%;
        margin-right: 8px;
        box-shadow: 0 0 10px #ef4444;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        50% {
            opacity: 0.5;
        }
    }
</style>

<div class="aurora-bg">
    <div class="aurora-blob blob-1"></div>
    <div class="aurora-blob blob-2"></div>
</div>

<div class="container pt-4">

    <!-- HEADER -->
    <div class="match-header">
        <a href="{% url 'match_list' %}" class="btn-back">
            <i class="fas fa-arrow-left mr-2"></i> Back to Hub
        </a>
        <div class="live-indicator">
            <div class="live-dot"></div> LIVE SIGNAL
        </div>
    </div>

    <div class="text-center mb-4">
        <h2 class="font-weight-bold mb-1">{{ match.title }}</h2>
        <p class="text-white-50 small m-0">{{ match.league }}</p>
    </div>

    <!-- PLAYER -->
    <div class="theater-container p-0">
        <div class="player-glass-frame">
            <iframe id="livestream" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>
        </div>
    </div>

    <div class="text-center mt-4">
        <p class="text-white-50 small">Having trouble? <a href="#" class="text-white text-decoration-underline"
                onclick="window.location.reload()">Reload Stream</a></p>
    </div>

</div>

<script>
    async function loadLivestream(matchId) {
        try {
            const response = await fetch(`/livestream/${matchId}/`);
            if (response.ok) {
                const data = await response.json();
                const livestreamUrl = data.livestream_url;

                // Redirect logic for Mobile
                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    // Show a message or redirect
                    // For now, implementing redirect as per original logic
                    window.location.href = livestreamUrl;
                } else {
                    document.getElementById('livestream').src = livestreamUrl;
                }
            } else {
                console.error('Failed to fetch livestream URL');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    const matchId = {{ match.id }};
    loadLivestream(matchId);
</script>

{% endblock %}